module load anaconda
source activate qiime1

#make OTUs and tree
pick_closed_reference_otus.py -i combined_1q.fasta -o output -p $PWD/otu_picking_params_97.txt -r $PWD/gg_13_5_otus/rep_set/97_otus.fasta -t $PWD/gg_13_5_otus/taxonomy/97_otu_taxonomy.txt

# predict a microbial community metagenome using PICRUST
cd output/
normalize_by_copy_number.py -i otu_table.biom -o normalized_otus.biom
predict_metagenomes.py -i normalized_otus.biom  -o metagenome_predictions.biom

#make phylogeny 
align_seqs.py -i combined_1q.fasta -o aligned_combined_1q.fasta
make_phylogeny.py -i aligned_combined_1q.fasta -o output/rep_phylo.tre

# analyzing the predicted metagenome

#chao1 alpha diversity
alpha_diversity.py -i normalized_otus.biom  -m chao1 -o adiv_chao1.txt
#beta-div
beta_diversity.py -i normalized_otus.biom -m euclidean -o beta_div
#core OTUS (present in at least 50% of the sample!)


#Make distance plots: based on the "Species"
make_distance_boxplots.py -d unweighted_unifrac_dm.txt -m Fasting_Map.txt -f "Treatment" -o out1

#Make a PCoA plot and beta diversity?
beta_diversity_through_plots.py -i otu_table.biom -o bdiv_even100/ -t rep_set.tre -m Fasting_Map.txt -e 100

#find how many species are shared by each sample 
shared_phylotypes.py -i otu_table.biom -o shared_otus.txt

#Make plots for your predicted metagenomeof functional categories at various levels using :
categorize_by_function.py -i metagenome_predictions.biom -c "KEGG_Pathways" -l 2 -o metagenome_at_level2.biom

#make qiime_parameter file qiime_params.txt
summarize_taxa:md_identifier    "KEGG_Pathways"
summarize_taxa:absolute_abundance   True
summarize_taxa:level    2
#do it!
summarize_taxa_through_plots.py -i metagenome_at_level2.biom -p qiime_params.txt -o plots_at_level2

